
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Long/Short SMA Strategy Widget</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background-color: #f9f9f9;
        }
        h2 {
            color: #333;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            font-weight: bold;
            display: inline-block;
            width: 250px;
        }
        input, select {
            padding: 5px;
            width: 150px;
        }
        .results {
            margin-top: 30px;
            padding: 15px;
            background-color: #fff;
            border: 1px solid #ccc;
        }
        canvas {
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <h2>Long/Short SMA Strategy Calculator</h2>
    <div class="input-group">
        <label for="portfolioSize">Initial Portfolio Size ($):</label>
        <input type="number" id="portfolioSize" value="1000000" step="1000">
    </div>
    <div class="input-group">
        <label for="leverageRatio">Leverage Ratio:</label>
        <select id="leverageRatio">
            <option value="0.3">130/30</option>
            <option value="0.45" selected>145/45</option>
            <option value="1.0">200/100</option>
        </select>
    </div>
    <div class="input-group">
        <label for="baseRate">Base Rate (%):</label>
        <input type="number" id="baseRate" value="4.50" step="0.01">
    </div>
    <div class="input-group">
        <label for="spread">Capital Markets Spread (%):</label>
        <input type="number" id="spread" value="0.50" step="0.01">
    </div>

    <div class="results">
        <p><strong>Total Amount Invested (Long & Short):</strong> $<span id="totalInvested">1900000</span></p>
        <p><strong>Long Extension:</strong> $<span id="longExtension">450000</span></p>
        <p><strong>Short Extension:</strong> $<span id="shortExtension">450000</span></p>
        <p><strong>Margin Borrowing Cost:</strong> -$<span id="marginCost">20250</span></p>
        <p><strong>Short Rebate Received:</strong> $<span id="shortRebate">15750</span></p>
        <p><strong>Net Cost to Investor:</strong> -$<span id="netCost">4500</span></p>
        <p><strong>Net Cost in Basis Points:</strong> <span id="bps">45</span> bps (<span id="bpsPercent">0.45%</span>)</p>
    </div>

    <canvas id="investmentChart" width="600" height="300"></canvas>

    <script>
        function updateCalculations() {
            const portfolioSize = parseFloat(document.getElementById('portfolioSize').value);
            const leverageRatio = parseFloat(document.getElementById('leverageRatio').value);
            const baseRate = parseFloat(document.getElementById('baseRate').value);
            const spread = parseFloat(document.getElementById('spread').value);

            const extensionAmount = Math.round(portfolioSize * leverageRatio);
            const totalInvested = Math.round(portfolioSize + extensionAmount * 2);

            const marginRate = baseRate + spread;
            const rebateRate = baseRate - spread;

            const marginCost = Math.round(extensionAmount * (marginRate / 100));
            const shortRebate = Math.round(extensionAmount * (rebateRate / 100));
            const netCost = marginCost - shortRebate;
            const bps = Math.round((netCost / portfolioSize) * 10000);
            const bpsPercent = ((netCost / portfolioSize) * 100).toFixed(2);

            document.getElementById('totalInvested').textContent = totalInvested.toLocaleString();
            document.getElementById('longExtension').textContent = extensionAmount.toLocaleString();
            document.getElementById('shortExtension').textContent = extensionAmount.toLocaleString();
            document.getElementById('marginCost').textContent = marginCost.toLocaleString();
            document.getElementById('shortRebate').textContent = shortRebate.toLocaleString();
            document.getElementById('netCost').textContent = netCost.toLocaleString();
            document.getElementById('bps').textContent = bps;
            document.getElementById('bpsPercent').textContent = `${bpsPercent}%`;

            updateChart(portfolioSize, extensionAmount);
        }

        function updateChart(portfolioSize, extensionAmount) {
            const ctx = document.getElementById('investmentChart').getContext('2d');
            if (window.investmentChart) {
                window.investmentChart.destroy();
            }
            window.investmentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Initial Portfolio', 'Long Extension', 'Short Extension'],
                    datasets: [{
                        label: 'Investment Breakdown',
                        data: [portfolioSize, extensionAmount, extensionAmount],
                        backgroundColor: ['#4CAF50', '#2196F3', '#FF9800']
                    }]
                },
                options: {
                    responsive: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        document.querySelectorAll('input, select').forEach(el => {
            el.addEventListener('input', updateCalculations);
        });

        updateCalculations();
    </script>
</body>
</html>
