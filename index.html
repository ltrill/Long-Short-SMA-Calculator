
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Long/Short SMA Strategy Widget</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background-color: #f9f9f9;
        }
        h1 {
            color: #333;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }
        input, select {
            padding: 8px;
            width: 200px;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            background-color: #fff;
            border: 1px solid #ccc;
        }
        canvas {
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <h1>Long/Short SMA Strategy Widget</h1>
    <div class="input-group">
        <label for="portfolioSize">Initial Portfolio Size ($):</label>
        <input type="number" id="portfolioSize" value="1000000" step="1000">
    </div>
    <div class="input-group">
        <label for="leverageRatio">Leverage Ratio:</label>
        <select id="leverageRatio">
            <option value="0.3">130/30</option>
            <option value="0.45" selected>145/45</option>
            <option value="1.0">200/100</option>
        </select>
    </div>
    <div class="input-group">
        <label for="baseRate">Base Rate (%):</label>
        <input type="number" id="baseRate" value="4.50" step="0.01">
    </div>
    <div class="input-group">
        <label for="spread">Capital Markets Spread (%):</label>
        <input type="number" id="spread" value="0.50" step="0.01">
    </div>
    <div class="results">
        <p><strong>Total Amount Invested (Long & Short):</strong> <span id="totalInvested"></span></p>
        <p><strong>Long Extension:</strong> <span id="longExtension"></span></p>
        <p><strong>Short Extension:</strong> <span id="shortExtension"></span></p>
        <p><strong>Margin Borrowing Cost:</strong> <span id="marginCost"></span></p>
        <p><strong>Short Rebate Received:</strong> <span id="shortRebate"></span></p>
        <p><strong>Net Cost to Investor:</strong> <span id="netCost"></span></p>
        <p><strong>Net Cost in Basis Points:</strong> <span id="netCostBps"></span></p>
    </div>
    <canvas id="investmentChart" width="600" height="400"></canvas>

    <script>
        function updateCalculations() {
            const portfolioSize = parseFloat(document.getElementById('portfolioSize').value);
            const leverageRatio = parseFloat(document.getElementById('leverageRatio').value);
            const baseRate = parseFloat(document.getElementById('baseRate').value);
            const spread = parseFloat(document.getElementById('spread').value);

            const extensionAmount = portfolioSize * leverageRatio;
            const totalInvested = portfolioSize + extensionAmount * 2;

            const marginRate = baseRate + spread;
            const rebateRate = baseRate - spread;

            const marginCost = -(extensionAmount * (marginRate / 100));
            const shortRebate = extensionAmount * (rebateRate / 100);
            const netCost = marginCost + shortRebate;
            const netCostBps = Math.round((netCost / portfolioSize) * 10000);
            const netCostPct = (netCost / portfolioSize * 100).toFixed(2);

            document.getElementById('totalInvested').textContent = `$${Math.round(totalInvested).toLocaleString()}`;
            document.getElementById('longExtension').textContent = `$${Math.round(extensionAmount).toLocaleString()}`;
            document.getElementById('shortExtension').textContent = `$${Math.round(extensionAmount).toLocaleString()}`;
            document.getElementById('marginCost').textContent = `-$${Math.round(Math.abs(marginCost)).toLocaleString()}`;
            document.getElementById('shortRebate').textContent = `$${Math.round(shortRebate).toLocaleString()}`;
            document.getElementById('netCost').textContent = `$${Math.round(netCost).toLocaleString()}`;
            document.getElementById('netCostBps').textContent = `${netCostBps} bps (${netCostPct}%)`;

            const ctx = document.getElementById('investmentChart').getContext('2d');
            if (window.investmentChart) {
                window.investmentChart.destroy();
            }
            window.investmentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Initial Portfolio', 'Long Extension', 'Short Extension'],
                    datasets: [{
                        label: 'Investment Breakdown',
                        data: [portfolioSize, extensionAmount, extensionAmount],
                        backgroundColor: ['#4CAF50', '#2196F3', '#FF9800']
                    }]
                },
                options: {
                    responsive: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        document.querySelectorAll('input, select').forEach(el => {
            el.addEventListener('input', updateCalculations);
        });

        updateCalculations();
    </script>
</body>
</html>
